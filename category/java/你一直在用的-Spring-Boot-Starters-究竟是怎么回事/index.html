<!doctype html><html lang=zh-cn itemscope itemtype=http://schema.org/WebPage><head><meta name=generator content="Hugo 0.113.0"><meta charset=utf-8><title>你一直在用的 Spring Boot Starters 究竟是怎么回事 · 古时的风筝</title><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=description content="Spring Boot 对比 Spring MVC 最大的优点就是使用简单，约定大于配置。不会像之前用 Spring MVC 的时候，时不时被 xml 配置文件搞的晕头转向，冷不防还因为 xml 配置上的一点疏忽，导"><meta name=keywords content="Hugo,theme,编程,java,ChatGPT,程序员,开发"><link rel=canonical href=https://moonkite.cn/category/java/%E4%BD%A0%E4%B8%80%E7%9B%B4%E5%9C%A8%E7%94%A8%E7%9A%84-Spring-Boot-Starters-%E7%A9%B6%E7%AB%9F%E6%98%AF%E6%80%8E%E4%B9%88%E5%9B%9E%E4%BA%8B/><link rel=icon href=https://moonkite.cn/images/photo.png><link rel=stylesheet href=https://cdn.usebootstrap.com/bootstrap/4.1.3/css/bootstrap.min.css><link rel=stylesheet href=https://moonkite.cn/css/den.css><script async src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script><meta name=referrer content="no-referrer-when-downgrade"><meta property="og:title" content="你一直在用的 Spring Boot Starters 究竟是怎么回事"><meta property="og:description" content="Spring Boot 对比 Spring MVC 最大的优点就是使用简单，约定大于配置。不会像之前用 Spring MVC 的时候，时不时被 xml 配置文件搞的晕头转向，冷不防还因为 xml 配置上的一点疏忽，导"><meta property="og:type" content="article"><meta property="og:url" content="https://moonkite.cn/category/java/%E4%BD%A0%E4%B8%80%E7%9B%B4%E5%9C%A8%E7%94%A8%E7%9A%84-Spring-Boot-Starters-%E7%A9%B6%E7%AB%9F%E6%98%AF%E6%80%8E%E4%B9%88%E5%9B%9E%E4%BA%8B/"><meta property="article:section" content="category"><meta property="article:published_time" content="2019-05-30T08:56:23+08:00"><meta property="article:modified_time" content="2019-05-30T08:56:23+08:00"><meta itemprop=name content="你一直在用的 Spring Boot Starters 究竟是怎么回事"><meta itemprop=description content="Spring Boot 对比 Spring MVC 最大的优点就是使用简单，约定大于配置。不会像之前用 Spring MVC 的时候，时不时被 xml 配置文件搞的晕头转向，冷不防还因为 xml 配置上的一点疏忽，导"><meta itemprop=datePublished content="2019-05-30T08:56:23+08:00"><meta itemprop=dateModified content="2019-05-30T08:56:23+08:00"><meta itemprop=wordCount content="2605"><meta itemprop=keywords content="Java,JDK,Spring Boot Starter,"><meta name=twitter:card content="summary"><meta name=twitter:title content="你一直在用的 Spring Boot Starters 究竟是怎么回事"><meta name=twitter:description content="Spring Boot 对比 Spring MVC 最大的优点就是使用简单，约定大于配置。不会像之前用 Spring MVC 的时候，时不时被 xml 配置文件搞的晕头转向，冷不防还因为 xml 配置上的一点疏忽，导"></head><body><div class=header-container style=background:linear-gradient(rgba(0,0,0,.2),rgba(0,0,0,.2)),url(https://moonkite.cn/images/background.png);background-position:top;background-size:cover><div class=container><nav class="header-nav navbar navbar-expand-md navbar-dark light-dark"><div class="header-logo navbar-brand"><a class=float-left href=https://moonkite.cn/></a></div><button class=navbar-toggler type=button data-toggle=collapse data-target=#navbarNav aria-controls=navbarNav aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="nav-menu collapse navbar-collapse" id=navbarNav><ul class=navbar-nav><li class=nav-item><a href=https://moonkite.cn/ class=nav-link><i class="fas fad fa-h-square"></i>主页</a></li><li class=nav-item><a href=https://moonkite.cn/category/notes/ class=nav-link><i class='fas fa-yin-yang'></i>生活随笔</a></li><li class=nav-item><a href=javascript:void(0) class=nav-link><i class='fas fa-laptop-code'></i>技术文章</a><div class=sub-dropdown-menu><a class=sub-nav-link href=https://moonkite.cn/category/java><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 48 48"><path fill="#f44336" d="M23.65 24.898c-.998-1.609-1.722-2.943-2.725-5.455C19.229 15.2 31.24 11.366 26.37 3.999c2.111 5.089-7.577 8.235-8.477 12.473-.823 3.898 5.752 8.426 5.757 8.426z"/><path fill="#f44336" d="M23.878 17.27c-.192 2.516 2.229 3.857 2.299 5.695.056 1.496-1.447 2.743-1.447 2.743s2.728-.536 3.579-2.818c.945-2.534-1.834-4.269-1.548-6.298.267-1.938 6.031-5.543 6.031-5.543S24.311 11.611 23.878 17.27z"/><g><path fill="#1565c0" d="M32.084 25.055c1.754-.394 3.233.723 3.233 2.01.0 2.901-4.021 5.643-4.021 5.643s6.225-.742 6.225-5.505c0-3.15-3.057-3.937-5.437-2.148zm-2.955 2.34s1.941-1.383 2.458-1.902c-4.763 1.011-15.638 1.147-15.638.269.0-.809 3.507-1.638 3.507-1.638s-7.773-.112-7.773 2.181C11.683 28.695 21.858 28.866 29.129 27.395z"/><path fill="#1565c0" d="M27.935 29.571c-4.509 1.499-12.814 1.02-10.354-.993-1.198.0-2.974.963-2.974 1.889.0 1.857 8.982 3.291 15.63.572l-2.302-1.468z"/><path fill="#1565c0" d="M18.686 32.739c-1.636.0-2.695 1.054-2.695 1.822.0 2.391 9.76 2.632 13.627.205l-2.458-1.632C24.271 34.404 17.014 34.579 18.686 32.739z"/><path fill="#1565c0" d="M36.281 36.632c0-.936-1.055-1.377-1.433-1.588 2.228 5.373-22.317 4.956-22.317 1.784.0-.721 1.807-1.427 3.477-1.093l-1.42-.839C11.26 34.374 9 35.837 9 37.017 9 42.52 36.281 42.255 36.281 36.632z"/><path fill="#1565c0" d="M39 38.604c-4.146 4.095-14.659 5.587-25.231 3.057C24.341 46.164 38.95 43.628 39 38.604z"/></g></svg>&nbsp;可爱的 Java</a>
<a class=sub-nav-link href=https://moonkite.cn/category/SpringCloud><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 48 48"><path fill="#8bc34a" d="M43.982 23.635c.069-4.261-.891-9.328-2.891-15.273L39.523 3.7l-2.13 4.433c-.114.237-.244.469-.38.698C33.514 5.827 28.974 4 24 4 12.954 4 4 12.954 4 24s8.954 20 20 20 20-8.954 20-20C44 23.877 43.984 23.758 43.982 23.635z"/><path fill="#fff" d="M39.385 32.558C36.262 36.86 30.734 37.091 25.531 37H18.75h-1.938c4.428-1.593 7.063-1.972 9.754-3.4 5.068-2.665 10.078-8.496 11.121-14.562-1.93 5.836-7.779 10.85-13.109 12.889-3.652 1.393-10.248 2.745-10.248 2.745l-.267-.145C9.573 32.268 9.437 22.214 17.6 18.968c3.574-1.423 6.993-.641 10.854-1.593 4.122-1.012 8.89-4.208 10.83-8.375C41.456 15.667 44.07 26.106 39.385 32.558zM15.668 38.445C15.386 38.795 14.955 39 14.505 39c-.823.0-1.495-.677-1.495-1.5s.677-1.5 1.495-1.5c.341.0.677.118.941.336C16.086 36.855 16.186 37.805 15.668 38.445z"/></svg>&nbsp; Spring Cloud 系列</a></div></li><li class=nav-item><a href=https://moonkite.cn/category/network class=nav-link><i class="fas fa-network-wired"></i>轻解计算机网络</a></li><li class=nav-item><a href=https://moonkite.cn/category/product class=nav-link><i class="fas fab fa-medapps"></i>我的产品</a></li></ul></div></nav></div><div class="container header-wrapper"><div class=row><div class=col-lg-12><div class=header-content><h1 class=header-title>你一直在用的 Spring Boot Starters 究竟是怎么回事</h1><p class=header-date>作者：
风筝 /
2019-05-30<div class=header-underline></div><div class=header-date>&nbsp·&nbsp
  <span id=busuanzi_container_page_pv>本文被阅读<span id=busuanzi_value_page_pv></span>次</span></div><div class=clearfix></div><p class="float-right header-tags"><i class="fas fa-tags" aria-hidden=true></i>
<a href=https://moonkite.cn/tag/Java/>Java</a>,
<a href=https://moonkite.cn/tag/JDK/>JDK</a>,
<a href=https://moonkite.cn/tag/Spring-Boot-Starter/>Spring Boot Starter</a></p></div></div></div></div></div><main><div class="container content"><article><p>Spring Boot 对比 Spring MVC 最大的优点就是使用简单，约定大于配置。不会像之前用 Spring MVC 的时候，时不时被 xml 配置文件搞的晕头转向，冷不防还因为 xml 配置上的一点疏忽，导致整个项目莫名其妙的不可用，顿感生活无所依恋，简称生无可恋。</p><p>这要归功于组成了 Spring Boot 的各种各样的 starters，有官方提供的，也有第三方开源出来。可以这么说，基本上你打算用的功能都可以找到，如果没有找到，那就再找一找。</p><p>用 Spring Boot 的功能组件（例如 spring-boot-starter-actuator、 spring-boot-starter-data-redis 等）的步骤非常简单，用著名的把大象放冰箱的方法来概括的话，有以下三步就可以完成组件功能的使用：</p><p><em>STEP 1</em></p><p>在 pom 文件中引入对应的包，例如：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=nt>&lt;dependency&gt;</span> 
</span></span><span class=line><span class=cl>  <span class=nt>&lt;groupId&gt;</span>org.springframework.boot<span class=nt>&lt;/groupId&gt;</span>  
</span></span><span class=line><span class=cl>  <span class=nt>&lt;artifactId&gt;</span>spring-boot-starter-actuator<span class=nt>&lt;/artifactId&gt;</span> 
</span></span><span class=line><span class=cl><span class=nt>&lt;/dependency&gt;</span>
</span></span></code></pre></div><p><em>STEP 2</em></p><p>在应用配置文件中加入相应的配置，配置都是组件约定好的，需要查看官方文档或者相关说明。有些比较复杂的组件，对应的参数和规则也相应的较多，有点可能多大几十上百了。</p><p><em>STEP 3</em></p><p>以上两步都正常的情况下，我们就可以使用组件提供的相关接口来开发业务功能了。</p><p>没错吧，这个过程我们在日常的开发中不知道已经实践了多少遍。那么 Spring Boot 为什么能做到如此简单易用呢，它内部是什么样的工作机制呢，不知道你有没有研究过。</p><p>以下是为了理解 Spring Boot 组件的实现机制而制作的一个 demo starter。理解其中的原理，对我们日后的工作有什么意义呢？</p><p><em>1.</em> 遇到问题的时候，可以帮助我们更有头绪的排查问题；</p><p><em>2.</em> 可以帮助我们正确的阅读源代码，组件的切入口在哪儿，配置属性是什么等等；</p><p><em>以上</em></p><p><em>以下</em>，开始实现这个简单的 starter，这个 starter 并没有什么实际的功能，只是为了做个演示而已。</p><p>开始之前，我们要理解一下 spring boot starter 是什么呢？</p><blockquote><p>实际上 starter 并不会包含多少功能代码，我们可以把它理解成一个「连接包」(我自己造的概念)，按照这个概念来说：</p><p>它首先是一个包，一个集合，它把需要用的其他功能组件囊括进来，放到自己的 pom 文件中。</p><p>然后它是一个连接，把它引入的组件和我们的项目做一个连接，并且在中间帮我们省去复杂的配置，力图做到使用最简单。</p></blockquote><p>实现一个 starter 有四个要素：</p><ol><li>starter 命名 ;</li><li>自动配置类，用来初始化相关的 bean ;</li><li>指明自动配置类的配置文件 spring.factories ;</li><li>自定义属性实体类，声明 starter 的应用配置属性 ;</li></ol><p>好了，开始实现我们的 demo</p><p><em>1. 给 starter 起个名字</em></p><p>也就是我们使用它的时候在 pom 中引用的 artifactId。命名有有规则的，官方规定：</p><p>官方的 starter 的命名格式为 spring-boot-starter-{name} ，例如上面提到的 spring-boot-starter-actuator。</p><p>非官方的 starter 的命名格式为 {name}-spring-boot-starter，我们把自定的 starter 命名为 kite-spring-boot-starter，命名在 pom 文件里。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=nt>&lt;groupId&gt;</span>kite.springcloud<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;artifactId&gt;</span>kite-spring-boot-starter<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;packaging&gt;</span>jar<span class=nt>&lt;/packaging&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;version&gt;</span>1.0-SNAPSHOT<span class=nt>&lt;/version&gt;</span>
</span></span></code></pre></div><p><em>2. 引入自动配置包及其它相关依赖包</em></p><p>实现 starter 主要依赖自动配置注解，所以要在 pom 中引入自动配置相关的两个 jar 包</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=nt>&lt;dependency&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;groupId&gt;</span>org.springframework.boot<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;artifactId&gt;</span>spring-boot-configuration-processor<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/dependency&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;dependency&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;groupId&gt;</span>org.springframework.boot<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;artifactId&gt;</span>spring-boot-autoconfigure<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/dependency&gt;</span>
</span></span></code></pre></div><p>除此之外，依赖的其他包当然也要引进来。</p><p><em>3. 创建 spring.factories 文件</em></p><p>在 resource/META-INF 目录下创建名称为 spring.factories 的文件，为什么在这里？当 Spring Boot 启动的时候，会在 classpath 下寻找所有名称为 spring.factories 的文件，然后运行里面的配置指定的自动加载类，将指定类(一个或多个)中的相关 bean 初始化。</p><p>例如本例中的配置信息是这样的：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-properties data-lang=properties><span class=line><span class=cl><span class=na>org.springframework.boot.autoconfigure.EnableAutoConfiguration</span><span class=o>=</span><span class=s>\
</span></span></span><span class=line><span class=cl><span class=s>  kite.springcloud.boot.starter.example.KiteAutoConfigure</span>
</span></span></code></pre></div><p>等号前面是固定的写法，后面就是我们自定义的自动配置类了，如果有多个的话，用英文逗号分隔开。</p><p><em>4. 编写自动配置类</em></p><p>自动配置类是用来初始化 starter 中的相关 bean 的。可以说是实现 starter 最核心的功能。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Configuration</span>
</span></span><span class=line><span class=cl><span class=nd>@ConditionalOnClass</span><span class=o>(</span><span class=n>KiteService</span><span class=o>.</span><span class=na>class</span><span class=o>)</span>
</span></span><span class=line><span class=cl><span class=nd>@EnableConfigurationProperties</span><span class=o>(</span><span class=n>KiteProperties</span><span class=o>.</span><span class=na>class</span><span class=o>)</span>
</span></span><span class=line><span class=cl><span class=nd>@Slf4j</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>KiteAutoConfigure</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@Autowired</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>KiteProperties</span> <span class=n>kiteProperties</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@Bean</span>
</span></span><span class=line><span class=cl>    <span class=nd>@ConditionalOnMissingBean</span><span class=o>(</span><span class=n>KiteService</span><span class=o>.</span><span class=na>class</span><span class=o>)</span>
</span></span><span class=line><span class=cl>    <span class=nd>@ConditionalOnProperty</span><span class=o>(</span><span class=n>prefix</span> <span class=o>=</span> <span class=s>&#34;kite.example&#34;</span><span class=o>,</span><span class=n>value</span> <span class=o>=</span> <span class=s>&#34;enabled&#34;</span><span class=o>,</span> <span class=n>havingValue</span> <span class=o>=</span> <span class=s>&#34;true&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>    <span class=n>KiteService</span> <span class=nf>kiteService</span><span class=o>(){</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=k>new</span> <span class=n>KiteService</span><span class=o>(</span><span class=n>kiteProperties</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>代码非常简单，放眼望去，最多的就是各种注解。</p><p>@Configuration 这个不用解释，表示这是个自动配置类，我们平时做项目时也会用到，一般是用作读取配置文件的时候。</p><p>@ConditionalOnClass(KiteService.class) ：</p><p>只有在 classpath 中找到 KiteService 类的情况下，才会解析此自动配置类，否则不解析。</p><p>@EnableConfigurationProperties(KiteProperties.class)：</p><p>启用配置类。</p><p>@Bean：实例化一个 bean 。</p><p>@ConditionalOnMissingBean(KiteService.class)：</p><p>与 @Bean 配合使用，只有在当前上下文中不存在某个 bean 的情况下才会执行所注解的代码块，也就是当前上下文还没有 KiteService 的 bean 实例的情况下，才会执行 kiteService() 方法，从而实例化一个 bean 实例出来。</p><p>@ConditionalOnProperty：</p><p>当应用配置文件中有相关的配置才会执行其所注解的代码块。</p><p>这个类的整体含义就是: 当 classpath 中存在 KiteService 类时解析此配置类，什么情况下才会在 classpath 中存在呢，就是项目引用了相关的 jar 包。并且在上下文中没有 KiteService 的 bean 实例的情况下，new 一个实例出来，并且将应用配置中的相关配置值传入。</p><p><em>5. 实现属性配置类</em></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Data</span>
</span></span><span class=line><span class=cl><span class=nd>@ConfigurationProperties</span><span class=o>(</span><span class=s>&#34;kite.example&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>KiteProperties</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>String</span> <span class=n>host</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kt>int</span> <span class=n>port</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>配置类很简单，只有两个属性，一个 host ，一个 port 。配置参数以 kite.example 作为前缀。稍后我们在使用这个 starter 的时候会看到如何声明配置属性。</p><p><em>6. 实现相关功能类</em></p><p>也就是前面一直提到的 KiteService，其实严格来讲，这个业务功能类不应该放在 starter 中，应该放在单独的 jar 包里，但是此处 demo 非常简单，也就在这里写了。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Slf4j</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>KiteService</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>String</span> <span class=n>host</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kt>int</span> <span class=n>port</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=nf>KiteService</span><span class=o>(</span><span class=n>KiteProperties</span> <span class=n>kiteProperties</span><span class=o>){</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=o>.</span><span class=na>host</span> <span class=o>=</span> <span class=n>kiteProperties</span><span class=o>.</span><span class=na>getHost</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=o>.</span><span class=na>port</span> <span class=o>=</span> <span class=n>kiteProperties</span><span class=o>.</span><span class=na>getPort</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>print</span><span class=o>(){</span>
</span></span><span class=line><span class=cl>        <span class=n>log</span><span class=o>.</span><span class=na>info</span><span class=o>(</span><span class=k>this</span><span class=o>.</span><span class=na>host</span> <span class=o>+</span> <span class=s>&#34;:&#34;</span> <span class=o>+</span><span class=k>this</span><span class=o>.</span><span class=na>port</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>一个构造函数和一个 print 方法。</p><p><em>7. 打包</em></p><p>通过 maven 命令将这个 starter 安装到本地 maven 仓库</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>mvn install
</span></span></code></pre></div><p>也可以通过 <code>mvn package deploy</code> 发布到你的私服</p><p>或者发布到中央仓库。</p><p>上面已经完成了 starter 的开发，并安装到了本地仓库，然后就是在我们的项目中使用它了。</p><p><em>1. 创建项目，在 pom 中引用</em></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=nt>&lt;dependency&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;groupId&gt;</span>kite.springcloud<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;artifactId&gt;</span>kite-spring-boot-starter<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;version&gt;</span>1.0-SNAPSHOT<span class=nt>&lt;/version&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/dependency&gt;</span>
</span></span></code></pre></div><p><em>2. 应用配置项</em></p><p>创建 application.yml ，配置如下:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>server</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>port</span><span class=p>:</span><span class=w> </span><span class=m>3801</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kite</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>example</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>  </span><span class=c># 开启才生效</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>host</span><span class=p>:</span><span class=w> </span><span class=m>127.0.0.1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>port</span><span class=p>:</span><span class=w> </span><span class=m>3801</span><span class=w>
</span></span></span></code></pre></div><p><em>3. 调用 KiteService 的服务方法</em></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@RestController</span>
</span></span><span class=line><span class=cl><span class=nd>@RequestMapping</span><span class=o>(</span><span class=n>value</span> <span class=o>=</span> <span class=s>&#34;use&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>UseController</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@Autowired</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>KiteService</span> <span class=n>kiteService</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@GetMapping</span><span class=o>(</span><span class=n>value</span> <span class=o>=</span> <span class=s>&#34;print&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>print</span><span class=o>(){</span>
</span></span><span class=line><span class=cl>        <span class=n>kiteService</span><span class=o>.</span><span class=na>print</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p><em>4. 启动服务，并访问接口</em></p><p>访问 /use/print 接口，会发现在日志中打印出了配置信息</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>2019-05-24 16:45:04.234  INFO <span class=m>36687</span> --- <span class=o>[</span>nio-3801-exec-1<span class=o>]</span> k.s.boot.starter.example.KiteService     : 127.0.0.1:3801
</span></span></code></pre></div><p>顺着上面的思路，我们来看一下官方的 starters 的结构。先来把 Spring Boot 从 github 上 clone 一份下来。用 idea 打开，可以看到项目结构如下</p><p><img src=https://hexo.moonkite.cn/blog/273364-20190530090732919-1726908847.png alt></p><p>Spring-boot-starters 中就是官方提供的主要 starters，比如 jdbc、redis、security、web 等等。</p><p>我们拿 spring-boot-starter-data-redis 这个 starter 作为例子，来说一说官方是怎么组织项目结构的，以及阅读源码的顺序应该是怎样的。</p><p><em>1.</em> 展开 Spring-boot-staters 下的 redis starter，我们看到目录结构如下</p><p><img src=https://hexo.moonkite.cn/blog/273364-20190530090747115-1091168717.png alt></p><p>其中并没有 Java 代码，只有一个 spring.provides 文件，里面的内容如下：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-properties data-lang=properties><span class=line><span class=cl><span class=na>provides</span><span class=o>:</span> <span class=s>spring-data-redis,lettuce-core</span>
</span></span></code></pre></div><p>意思就是说，本项目依赖 spring-data-redis 和 lettuce-core 这两个包，并且在 pom 文件中引用了。其目的就是告知使用者在引用此包的时候，不必再引用 provides 中的依赖包了。</p><p><em>2.</em> 然后就是自动注解了，所有 stater 的自动注解类、属性配置类都放到了 spring-boot-autoconfigure 这个项目下</p><p><img src=https://hexo.moonkite.cn/blog/273364-20190530090758608-1547893516.png alt></p><p>看到熟悉的 spring.factories 没有，前面我们自己实现过。这个内容比较多，我们只看 redis 相关的</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-properties data-lang=properties><span class=line><span class=cl><span class=err>org.springframework.boot.autoconfigure.data.redis.RedisAutoConfiguration,\</span>
</span></span><span class=line><span class=cl><span class=err>org.springframework.boot.autoconfigure.data.redis.RedisReactiveAutoConfiguration,\</span>
</span></span><span class=line><span class=cl><span class=err>org.springframework.boot.autoconfigure.data.redis.RedisRepositoriesAutoConfiguration</span>
</span></span></code></pre></div><p>包含三个自动配置文件，然后顺着配置，我们找到所在 package</p><p><img src=https://hexo.moonkite.cn/blog/273364-20190530090811254-1061268869.png alt></p><p>然后就可以开始阅读代码了。其他的 starter 也是同样的结构。</p><p>参考内容:
<a href=https://docs.spring.io/spring-boot/docs/current/reference/html/boot-features-developing-auto-configuration.html#boot-features-custom-starter>https://docs.spring.io/spring-boot/docs/current/reference/html/boot-features-developing-auto-configuration.html#boot-features-custom-starter</a></p></article><h4>相关文章</h4><dl class=row><dd class=col-md-9><a href=/category/SpringCloud/0-Srping-Cloud-%E5%BC%80%E7%AF%87/>0. Spring Cloud 是什么</a></dd><dd class=col-md-9><a href=/category/SpringCloud/1-Spring-Cloud-Eureka-%E5%AE%9E%E7%8E%B0%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E4%B8%8E%E5%8F%91%E7%8E%B0/>1. Spring Cloud Eureka 实现服务注册与发现</a></dd><dd class=col-md-9><a href=/category/SpringCloud/2-Spring-Cloud-Eureka-%E5%AE%9E%E7%8E%B0%E5%AE%89%E5%85%A8%E6%8E%A7%E5%88%B6/>2. Spring Cloud Eureka 实现安全控制</a></dd><dd class=col-md-9><a href=/category/SpringCloud/3-Spring-Cloud-Eureka-%E5%AE%9E%E7%8E%B0%E9%AB%98%E5%8F%AF%E7%94%A8%E6%9C%8D%E5%8A%A1%E5%8F%91%E7%8E%B0%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83/>3. Spring Cloud Eureka 实现高可用服务发现注册中心</a></dd><dd class=col-md-9><a href=/category/SpringCloud/4.-Spring-Cloud-Config-%E5%AE%9E%E7%8E%B0%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83/>4. Spring Cloud Config 实现配置中心，看这一篇就够了</a></dd></dl><div class=author-card><div class=underline></div><div class=author-box><div class=qr-author-image><a href=https://www.moonkite.cn><img src=/images/person.jpg alt=风筝></a></div><div class=author-content><p class=author-title>作者</p><p class=author-name>风筝</p><p class=author-desc>古时的风筝，一个平庸的程序员，主语言 Java，第二语言 Python，其实学 Python 的时间比 Java 还要早。喜欢写博客，写博客的过程能加深自己对一个知识点的理解，同时还可以分享给他人。喜欢做一些小东西，所以也会一些前端的东西，React、JavaScript、CSS 都会一些，做一些小工具还够用。</p></div></div></div><script src=https://utteranc.es/client.js repo=huzhicheng/blog-comment issue-term=pathname theme=github-light crossorigin=anonymous async></script></div></main><div class="footer gradient-2"><div class="container footer-container"><div class=row><div class="col-xs-4 col-sm-3 col-md-3 col-lg-3"><div class=footer-title>网站地图</div><ul class=list-unstyled><li><a href=https://moonkite.cn/tags/>标签</a></li><li><a href=https://moonkite.cn/categories/>分类</a></li><li><a rel=alternate type=application/rss+xml href=https://moonkite.cn/index.xml><i class="fas fa-rss-square"></i> RSS订阅</a></li></ul></div><div class="col-xs-4 col-sm-3 col-md-3 col-lg-3"><div class=footer-title>社群</div><ul class=list-unstyled><li><a href=https://github.com/huzhicheng rel=noopener target=_blank>GitHub</a></li></ul></div><div class="col-xs-4 col-sm-3 col-md-3 col-lg-3"><div class=footer-title>友链</div><ul class=list-unstyled><li><a href=https://github.com/huzhicheng rel=noopener target=_blank>关于我</a></li></ul></div><div class="col-xs-12 col-sm-3 col-md-3 col-lg-3"><p class="pull-right text-right"><small><em>Proudly powered by <a href=https://gohugo.io/ rel=noopener target=_blank>Hugo</a></em></small><br><small><em>Theme - <a href=https://github.com/shaform/hugo-theme-den rel=noopener target=_blank>Den</a></em></small><br><small>&copy;
风筝
2023</small></p></div></div><script>var _hmt=_hmt||[];(function(){var e,t=document.createElement("script");t.src="https://hm.baidu.com/hm.js?e417ddf834c7bb7411207e1fa09815aa",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e)})()</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-C714TFXRD4"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-C714TFXRD4")</script><div class=busuanzi-footer><span id=busuanzi_container_site_pv>本站总访问量<span id=busuanzi_value_site_pv></span>次</span>
<span id=busuanzi_container_site_uv>本站访客数<span id=busuanzi_value_site_uv></span>人次</span></div></div></div><script src=https://code.jquery.com/jquery-3.3.1.slim.min.js integrity=sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo crossorigin=anonymous></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js integrity=sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49 crossorigin=anonymous></script>
<script src=/js/bootstrap_4.1.3_js_bootstrap.min.js integrity=sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy crossorigin=anonymous></script>
<script>$(document).ready(function(){$("#load_disqus").length&&$(window).scroll(function(){if($("#load_disqus").length){var e=$("#load_disqus").offset().top,t=$(window).scrollTop(),n=t+$(window).height();t<e&&e<n&&load_disqus()}})})</script></body></html>