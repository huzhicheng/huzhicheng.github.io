<!doctype html><html lang=zh-cn itemscope itemtype=http://schema.org/WebPage><head><meta name=generator content="Hugo 0.113.0"><meta charset=utf-8><title>过两年 JVM 可能就要被GraalVM替代了 · 古时的风筝</title><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=description content="今天说一说 GraalVM。 GraalVM 是 Oracle 大力发展和想要推广的新一代 JVM ，目前很多框架都已经渐渐支持 GraalVM 了，比如我们在用的 Spring 也已经推出了对 GraalVM 兼容的工具包了"><meta name=keywords content="Hugo,theme,编程,java,ChatGPT,程序员,开发"><link rel=canonical href=https://moonkite.cn/category/java/Graalvm/><link rel=icon href=https://moonkite.cn/images/photo.png><link rel=stylesheet href=https://cdn.usebootstrap.com/bootstrap/4.1.3/css/bootstrap.min.css><link rel=stylesheet href=https://moonkite.cn/css/den.css><script async src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script><meta name=referrer content="no-referrer-when-downgrade"><meta property="og:title" content="过两年 JVM 可能就要被GraalVM替代了"><meta property="og:description" content="今天说一说 GraalVM。 GraalVM 是 Oracle 大力发展和想要推广的新一代 JVM ，目前很多框架都已经渐渐支持 GraalVM 了，比如我们在用的 Spring 也已经推出了对 GraalVM 兼容的工具包了"><meta property="og:type" content="article"><meta property="og:url" content="https://moonkite.cn/category/java/Graalvm/"><meta property="article:section" content="category"><meta property="article:published_time" content="2022-12-13T08:56:23+08:00"><meta property="article:modified_time" content="2022-12-13T08:56:23+08:00"><meta itemprop=name content="过两年 JVM 可能就要被GraalVM替代了"><meta itemprop=description content="今天说一说 GraalVM。 GraalVM 是 Oracle 大力发展和想要推广的新一代 JVM ，目前很多框架都已经渐渐支持 GraalVM 了，比如我们在用的 Spring 也已经推出了对 GraalVM 兼容的工具包了"><meta itemprop=datePublished content="2022-12-13T08:56:23+08:00"><meta itemprop=dateModified content="2022-12-13T08:56:23+08:00"><meta itemprop=wordCount content="3778"><meta itemprop=keywords content="Java,JDK,JVM,GraalVM,"><meta name=twitter:card content="summary"><meta name=twitter:title content="过两年 JVM 可能就要被GraalVM替代了"><meta name=twitter:description content="今天说一说 GraalVM。 GraalVM 是 Oracle 大力发展和想要推广的新一代 JVM ，目前很多框架都已经渐渐支持 GraalVM 了，比如我们在用的 Spring 也已经推出了对 GraalVM 兼容的工具包了"></head><body><div class=header-container style=background:linear-gradient(rgba(0,0,0,.2),rgba(0,0,0,.2)),url(https://moonkite.cn/images/background.png);background-position:top;background-size:cover><div class=container><nav class="header-nav navbar navbar-expand-md navbar-dark light-dark"><div class="header-logo navbar-brand"><a class=float-left href=https://moonkite.cn/></a></div><button class=navbar-toggler type=button data-toggle=collapse data-target=#navbarNav aria-controls=navbarNav aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="nav-menu collapse navbar-collapse" id=navbarNav><ul class=navbar-nav><li class=nav-item><a href=https://moonkite.cn/ class=nav-link><i class="fas fad fa-h-square"></i>主页</a></li><li class=nav-item><a href=https://moonkite.cn/category/notes/ class=nav-link><i class='fas fa-yin-yang'></i>生活随笔</a></li><li class=nav-item><a href=javascript:void(0) class=nav-link><i class='fas fa-laptop-code'></i>技术文章</a><div class=sub-dropdown-menu><a class=sub-nav-link href=https://moonkite.cn/category/java><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 48 48"><path fill="#f44336" d="M23.65 24.898c-.998-1.609-1.722-2.943-2.725-5.455C19.229 15.2 31.24 11.366 26.37 3.999c2.111 5.089-7.577 8.235-8.477 12.473-.823 3.898 5.752 8.426 5.757 8.426z"/><path fill="#f44336" d="M23.878 17.27c-.192 2.516 2.229 3.857 2.299 5.695.056 1.496-1.447 2.743-1.447 2.743s2.728-.536 3.579-2.818c.945-2.534-1.834-4.269-1.548-6.298.267-1.938 6.031-5.543 6.031-5.543S24.311 11.611 23.878 17.27z"/><g><path fill="#1565c0" d="M32.084 25.055c1.754-.394 3.233.723 3.233 2.01.0 2.901-4.021 5.643-4.021 5.643s6.225-.742 6.225-5.505c0-3.15-3.057-3.937-5.437-2.148zm-2.955 2.34s1.941-1.383 2.458-1.902c-4.763 1.011-15.638 1.147-15.638.269.0-.809 3.507-1.638 3.507-1.638s-7.773-.112-7.773 2.181C11.683 28.695 21.858 28.866 29.129 27.395z"/><path fill="#1565c0" d="M27.935 29.571c-4.509 1.499-12.814 1.02-10.354-.993-1.198.0-2.974.963-2.974 1.889.0 1.857 8.982 3.291 15.63.572l-2.302-1.468z"/><path fill="#1565c0" d="M18.686 32.739c-1.636.0-2.695 1.054-2.695 1.822.0 2.391 9.76 2.632 13.627.205l-2.458-1.632C24.271 34.404 17.014 34.579 18.686 32.739z"/><path fill="#1565c0" d="M36.281 36.632c0-.936-1.055-1.377-1.433-1.588 2.228 5.373-22.317 4.956-22.317 1.784.0-.721 1.807-1.427 3.477-1.093l-1.42-.839C11.26 34.374 9 35.837 9 37.017 9 42.52 36.281 42.255 36.281 36.632z"/><path fill="#1565c0" d="M39 38.604c-4.146 4.095-14.659 5.587-25.231 3.057C24.341 46.164 38.95 43.628 39 38.604z"/></g></svg>&nbsp;可爱的 Java</a>
<a class=sub-nav-link href=https://moonkite.cn/category/SpringCloud><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 48 48"><path fill="#8bc34a" d="M43.982 23.635c.069-4.261-.891-9.328-2.891-15.273L39.523 3.7l-2.13 4.433c-.114.237-.244.469-.38.698C33.514 5.827 28.974 4 24 4 12.954 4 4 12.954 4 24s8.954 20 20 20 20-8.954 20-20C44 23.877 43.984 23.758 43.982 23.635z"/><path fill="#fff" d="M39.385 32.558C36.262 36.86 30.734 37.091 25.531 37H18.75h-1.938c4.428-1.593 7.063-1.972 9.754-3.4 5.068-2.665 10.078-8.496 11.121-14.562-1.93 5.836-7.779 10.85-13.109 12.889-3.652 1.393-10.248 2.745-10.248 2.745l-.267-.145C9.573 32.268 9.437 22.214 17.6 18.968c3.574-1.423 6.993-.641 10.854-1.593 4.122-1.012 8.89-4.208 10.83-8.375C41.456 15.667 44.07 26.106 39.385 32.558zM15.668 38.445C15.386 38.795 14.955 39 14.505 39c-.823.0-1.495-.677-1.495-1.5s.677-1.5 1.495-1.5c.341.0.677.118.941.336C16.086 36.855 16.186 37.805 15.668 38.445z"/></svg>&nbsp; Spring Cloud 系列</a></div></li><li class=nav-item><a href=https://moonkite.cn/category/network class=nav-link><i class="fas fa-network-wired"></i>轻解计算机网络</a></li><li class=nav-item><a href=https://moonkite.cn/category/product class=nav-link><i class="fas fab fa-medapps"></i>我的产品</a></li></ul></div></nav></div><div class="container header-wrapper"><div class=row><div class=col-lg-12><div class=header-content><h1 class=header-title>过两年 JVM 可能就要被GraalVM替代了</h1><p class=header-date>作者：
风筝 /
2022-12-13<div class=header-underline></div><div class=header-date>&nbsp·&nbsp
  <span id=busuanzi_container_page_pv>本文被阅读<span id=busuanzi_value_page_pv></span>次</span></div><div class=clearfix></div><p class="float-right header-tags"><i class="fas fa-tags" aria-hidden=true></i>
<a href=https://moonkite.cn/tag/GraalVM/>GraalVM</a>,
<a href=https://moonkite.cn/tag/Java/>Java</a>,
<a href=https://moonkite.cn/tag/JDK/>JDK</a>,
<a href=https://moonkite.cn/tag/JVM/>JVM</a></p></div></div></div></div></div><main><div class="container content"><article><p>今天说一说 GraalVM。</p><p>GraalVM 是 Oracle 大力发展和想要推广的新一代 JVM ，目前很多框架都已经渐渐支持 GraalVM 了，比如我们在用的 Spring 也已经推出了对 GraalVM 兼容的工具包了。</p><p>既然说的这么厉害，那么它到底是何方神圣呢。</p><h2 id=graalvm-和-jvm-的关系>GraalVM 和 JVM 的关系</h2><p>既然叫做VM，那肯定和 JVM 有关系的吧。JVM 全称 Java 虚拟机，我们都知道，Java 程序是运行在虚拟机上的，虚拟机提供 Java 运行时，支持解释执行和部分的（JIT）即时编译器，并且负责分配和管理 Java 运行所需的内存，我们所说的各种垃圾收集器都工作在 JVM 中。</p><p>比如 Oracle JDK、OpenJDK ，默认的 JVM 是 HotSpot 虚拟机，这是当前应用最广泛的一个虚拟机。我们平时见到的各种将虚拟机的书籍、文章、面试题，基本上都是说的 HotSpot 虚拟机。</p><p>除此之外，还有一些商用，或者说小众的虚拟机存在，比如IBM 的J9 JVM，商用的 Zing VM 等。</p><p>那 GraalVM 是另一种 Java 虚拟机吗？</p><p>是，又不全是。</p><p>GraalVM 可以完全取代上面提到的那几种虚拟机，比如 HotSpot。把你之前运行在 HotSpot 上的代码直接平移到 GraalVM 上，不用做任何的改变，甚至都感知不到，项目可以完美的运行。</p><p>但是 GraalVM 还有更广泛的用途，不仅支持 Java 语言，还支持其他语言。这些其他语言不仅包括嫡系的 JVM 系语言，例如 Kotlin、Scala，还包括例如 JavaScript、Nodejs、Ruby、Python 等。</p><p><img src=https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/85cedb09df80420c9ee6108117fa8adb~tplv-k3u1fbpfcp-zoom-1.image alt></p><p>GraalVM 的野心不止于此，看上面的图，它的目的是搭建一个 Framework，最终的目标是想要支持任何一种语言，无论哪种语言，可以共同跑在 GraalVM 上，不存在跨语言调用的壁垒。</p><h2 id=graalvm-和jdk有什么关系>GraalVM 和JDK有什么关系</h2><p>Java 虚拟机都是内置在 JDK 中的，比如Orcale JDK、OpenJDK，默认内置的都是 HotSpot 虚拟机。</p><p>GraalVM 也是一种 JDK，一种高性能的 JDK。完全可以用它替代 OpenJDK、Orcale JDK。</p><h2 id=graalvm-如何运行-java-程序>GraalVM 如何运行 Java 程序</h2><p>说了半天，是不是还是不知道 GraalVM 到底是什么。</p><ul><li><p>GraalVM - 还包含 Graal （JIT）即时编译器，可以结合 HotSpot 使用</p></li><li><p>GraalVM – 是一种高性能 JDK，旨在加速 Java 应用程序性能，同时消耗更少的资源。</p></li><li><p>GraalVM - 是一种支持多语言混编的虚拟机程序，不仅可以运行 JVM 系列的语言，也可支持其他语言。</p></li></ul><p>GraalVM 提供了两种方式来运行 Java 程序。</p><h3 id=第一种结合-hotspot-使用>第一种：结合 HotSpot 使用</h3><p>上面说了，GraalVM 包含 Graal （JIT）即时编译器，自从 JDK 9u 版本之后，Orcale JDK 和 OpenJDK 就集成了 Graal 即时编译器。我们知道 Java 既有解释运行也有即时编译。</p><p>当程序运行时，解释器首先发挥作用，代码可以直接执行。随着时间推移，即时编译器逐渐发挥作用，把越来越多的代码编译优化成本地代码，来获取更高的执行效率。即时编译器可以选择性地编译热点代码，省去了很多编译时间，也节省很多的空间。比如多次执行的方法或者循环、递归等。</p><p>JDK 默认使用的是 C2 即时编译器，C2是用C++编写的。而使用下面的参数可以用 Graal 替换 C2。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>-XX:+UnlockExperimentalVMOptions -XX:+UseJVMCICompiler
</span></span></code></pre></div><p>Graal 编译器是用 Java 实现的，用 Java 实现自己的编译器。Graal 基于一些假设的条件，采取更加激进的方式进行优化。采用 Graal 编译器之后，对性能有会有一定的提升。</p><p>但是如果你还是在用 JDK8，那对不起了，GraalVM 的一切都用不了。</p><h3 id=第二种aot-编译本地可执行程序>第二种：AOT 编译本地可执行程序</h3><p>这是 GraalVM 真正厉害的地方。</p><p>AOT 提前编译，是相对于即时编译而言的。AOT在运行过程中耗费 CPU 资源来进行即时编译，而程序也能够在启动的瞬间就达到理想的性能。例如 C 和 C++语言采用的是AOT静态编译，直接将代码转换成机器码执行。而 Java 一直采用的是解释 + 即时编译技术，大多数情况下 Java 即时编译的性能并不比静态编译差，但是还是一直朝着 AOT 编译的方向努力。</p><p>但是 Java 对于 AOT 来说有一些难点，比如类的动态加载和反射调用。</p><p>GraalVM 显然是已经克服了这些问题，使用 GraalVM 可以直接将 Java 代码编译成本地机器码形态的可执行程序。</p><p>我们目前运行 Java 一定要安装 JDK 或者 JRE 对不对，如果将程序直接编译成可执行程序，就不用在服务器上安装 JDK 或 JRE 了。那就是说运行 Java 代码其实也可以不用虚拟机了是吗？</p><p>GraalVM 的 AOT 编译实际上是借助了 SubstrateVM 编译框架，可以将 SubstrateVM 理解为一个内嵌精简版的 JVM，包含异常处理，同步，线程管理，内存管理（垃圾回收）和 JNI 等组件。</p><p>SubstrateVM 的启动时间非常短，内存开销非常少。用这种方式编译出的 Java 程序的执行时间可与C语言持平。</p><p>下图是使用即时编译（JVM运行）与 AOT (原生可执行程序)两种方式的 CPU 和内存使用情况对比，可以看出来，AOT 方式下 CPU 和内存的使用都非常少。</p><p><img src=https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/aae8240e7bd040ad96cc4947ad3c548d~tplv-k3u1fbpfcp-zoom-1.image alt></p><p>除了运行时占用的内存少之外，用这种方式最终生成的可执行文件也非常小。这对于云端部署非常友好。目前很多场景下都使用 Docker 容器的方式部署，打一个 Java 程序的镜像包要包含完整的 JVM 环境和编译好的 Jar 包。而AOT 方式可以最大限度的缩小 Docker 镜像的体积。</p><p><strong>缺点</strong></p><p>好处多多，当然也有一些弊端。对于反射这种纯粹在运行时才能确定的部分，不可能完全通过优化编译器解决，只能通过增加配置的方式解决。麻烦是麻烦了一点，但是是可行的，Spring Boot 2.7的版本已经支持原生镜像了，Spring 这种非常依赖反射的框架都可以支撑，我们用起来也应该没问题。</p><h2 id=graalvm-如何支持多语言>GraalVM 如何支持多语言</h2><p>要支持多语言，就要说到 GraalVM 中的另一个核心组件 Truffle 了。</p><p>Truffle 是一个用 Java 写就的语言实现框架。基于 Truffle 的语言实现仅需用 Java 实现词法分析、语法分析以及针对语法分析所生成的抽象语法树（Abstract Syntax Tree，AST）的解释执行器，便可以享用由 Truffle 提供的各项运行时优化。</p><p>就一个完整的 Truffle 语言实现而言，由于实现本身以及其所依赖的 Truffle 框架部分都是用 Java 实现的，因此它可以运行在任何 Java 虚拟机之上。</p><p>当然，如果 Truffle 运行在附带了 Graal 编译器的 Java 虚拟机之上，那么它将调用 Graal 编译器所提供的 API，主动触发对 Truffle 语言的即时编译，将对 AST 的解释执行转换为执行即时编译后的机器码。</p><p><img src=https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/87d8ead82cc54120b3e91a98465fb12d~tplv-k3u1fbpfcp-zoom-1.image alt></p><p>目前除了 Java， JavaScript、Ruby、Python 和许多其他流行语言都已经可以运行在 GraalVM 之上了。</p><p>GraalVM 官方还提供了完整的文档，当有一天你开发了一款新的语言，也可以用 Truffle 让它跑在 GraalVM 上。</p><p><img src=https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5f487e72828d4b4d892a4cde51bea8fd~tplv-k3u1fbpfcp-zoom-1.image alt></p><h3 id=安装和使用>安装和使用</h3><p>GraalVm 目前的最新版本是 22.3，分为社区版和企业版，就好像 OpenJDK 和 商用的 Orcale 的 JDK ，企业版会多一些性能分析的功能，用来帮助更大程度的优化性能。</p><p>社区版是基于OpenJDK 11.0.17, 17.0.5, 19.0.1，而商业版基于Oracle JDK 8u351, 11.0.17, 17.0.5, 19.0.1，所以，如果你想用免费的，只能将程序升级到 JDK 11 以上了。</p><p><img src=https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7d5f3f31ebe04241a7b5a466382889aa~tplv-k3u1fbpfcp-zoom-1.image alt></p><p>GraalVM 支持 Windows、Linux、MacOS ，可以用命令安装最新版，或者直接下载对应 Java 版本的。</p><p><img src=https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/950626b9458844f7ad06ced978787ee5~tplv-k3u1fbpfcp-zoom-1.image alt></p><p>我是下载的 Java 11 的版本，下载下来的压缩包，直接解压，然后配置环境变量。把解压目录配置到环境变量的 <code>JAVA_HOME</code>就可以了。</p><p>解压好其实就相当于安装完毕了，查看一下版本。</p><p>进入到解压目录下的<code>bin</code>目录中，运行 <code>java -version</code>。运行结果如下：</p><p><img src=https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/97101a8288334db2a9872df728c7b481~tplv-k3u1fbpfcp-zoom-1.image alt=image-20221130105634757></p><h2 id=运行代码>运行代码</h2><h3 id=常用方式运行>常用方式运行</h3><p>也就是我们平时一直在用的这种方式，把 GrralVM 当做 OpenJDK 使用，只不过把即时编译器换成了 Graal 。就是前面说的第一种方式。</p><p>安装完成后，就可以把它当做正常的 JDK 使用了，比如 <code>javac</code>、<code>jps</code>、<code>jmap</code>等都可以直接用了。大多数人还是用 IDEA 的，所以就直接在 IDEA 中使用就好了。</p><p>1、先随意创建一个 Java 项目。</p><p>2、创建完成后，打开项目设置。</p><p><img src=https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0dd751cb7d294df781f77552064615f2~tplv-k3u1fbpfcp-zoom-1.image alt></p><p>3、在打开的项目设置弹出框中选择 <code>SDKs</code>，点击加号，选择前面解压的 GraalVM 目录。</p><p><img src=https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a3d3f721b00a410e9d490234165ddc41~tplv-k3u1fbpfcp-zoom-1.image alt></p><p>4、然后选择刚刚添加的这个 JDK。</p><p><img src=https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/744a58afa8f9430fb4cc34daee5c0d18~tplv-k3u1fbpfcp-zoom-1.image alt></p><p>5、最后运行一段测试代码。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>HelloWorld</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;Hello GraalVM!&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>Thread</span><span class=o>.</span><span class=na>sleep</span><span class=o>(</span><span class=mi>1000</span> <span class=o>*</span> <span class=mi>100</span> <span class=o>*</span> <span class=mi>100</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p><img src=https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c7f797c478b04af8ad606767b6d9458e~tplv-k3u1fbpfcp-zoom-1.image alt></p><p>上面这样的运行方式，其实就相当于前面说的第一种运行方式</p><h3 id=native-image-方式运行>native-image 方式运行</h3><p>这种方式就是 AOT 编译成机器码，已可执行文件的形式出现。<code>native-image</code> 可以命令行的形式执行，也可以在配合 Maven 执行，我这儿就直接演示用 Maven 形式的了，毕竟IDEA 搭配 Maven 用习惯了。</p><p>1、<strong>安装<code>native-image</code> 工具包</strong></p><p><code>native-image</code> 是用来进行 AOT 编译打包的工具，先把这个装上，才能进行后面的步骤。</p><p>安装好 GraalVM 后，在 <code>bin</code>目录下有一个叫做 <code>gu</code>的工具，用这个工具安装，如果将 <code>bin</code>目录添加到环境中，直接下面的命令安装就行了。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>gu install native-image
</span></span></code></pre></div><p>如果没有将 <code>bin</code>目录加到环境变量中，要进入到 <code>bin</code>目录下，执行下面的命令安装。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>./gu install native-image
</span></span></code></pre></div><p>这个过程可能比较慢，因为要去 github 上下载东西，如果一次没成功（比如超时），多试两次就好了。</p><p>2、<strong>配置 Maven</strong></p><p>配置各种版本</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl> <span class=nt>&lt;properties&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;project.build.sourceEncoding&gt;</span>UTF-8<span class=nt>&lt;/project.build.sourceEncoding&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;maven.compiler.source&gt;</span>${java.specification.version}		<span class=nt>&lt;/maven.compiler.source&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;maven.compiler.target&gt;</span>${java.specification.version}<span class=nt>&lt;/maven.compiler.target&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;native.maven.plugin.version&gt;</span>0.9.12<span class=nt>&lt;/native.maven.plugin.version&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;imageName&gt;</span>graalvm-demo-image<span class=nt>&lt;/imageName&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;mainClass&gt;</span>org.graalvm.HelloWorld<span class=nt>&lt;/mainClass&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;/properties&gt;</span>
</span></span></code></pre></div><p><code>native.maven.plugin.version</code>是要用到的编译为可执行程序的 Maven 插件版本。</p><p><code>imageName</code>是生成的可执行程序的名称。</p><p><code>mainClass</code>是入口类全名称。</p><p>配置 build 插件</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl>  <span class=nt>&lt;build&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;plugins&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;plugin&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;groupId&gt;</span>org.codehaus.mojo<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;artifactId&gt;</span>exec-maven-plugin<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;version&gt;</span>3.0.0<span class=nt>&lt;/version&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;executions&gt;</span>
</span></span><span class=line><span class=cl>          <span class=nt>&lt;execution&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;id&gt;</span>java-agent<span class=nt>&lt;/id&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;goals&gt;</span>
</span></span><span class=line><span class=cl>              <span class=nt>&lt;goal&gt;</span>exec<span class=nt>&lt;/goal&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;/goals&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;configuration&gt;</span>
</span></span><span class=line><span class=cl>              <span class=nt>&lt;executable&gt;</span>java<span class=nt>&lt;/executable&gt;</span>
</span></span><span class=line><span class=cl>              <span class=nt>&lt;workingDirectory&gt;</span>${project.build.directory}<span class=nt>&lt;/workingDirectory&gt;</span>
</span></span><span class=line><span class=cl>              <span class=nt>&lt;arguments&gt;</span>
</span></span><span class=line><span class=cl>                <span class=nt>&lt;argument&gt;</span>-classpath<span class=nt>&lt;/argument&gt;</span>
</span></span><span class=line><span class=cl>                <span class=nt>&lt;classpath/&gt;</span>
</span></span><span class=line><span class=cl>                <span class=nt>&lt;argument&gt;</span>${mainClass}<span class=nt>&lt;/argument&gt;</span>
</span></span><span class=line><span class=cl>              <span class=nt>&lt;/arguments&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;/configuration&gt;</span>
</span></span><span class=line><span class=cl>          <span class=nt>&lt;/execution&gt;</span>
</span></span><span class=line><span class=cl>          <span class=nt>&lt;execution&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;id&gt;</span>native<span class=nt>&lt;/id&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;goals&gt;</span>
</span></span><span class=line><span class=cl>              <span class=nt>&lt;goal&gt;</span>exec<span class=nt>&lt;/goal&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;/goals&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;configuration&gt;</span>
</span></span><span class=line><span class=cl>              <span class=nt>&lt;executable&gt;</span>${project.build.directory}/${imageName}<span class=nt>&lt;/executable&gt;</span>
</span></span><span class=line><span class=cl>              <span class=nt>&lt;workingDirectory&gt;</span>${project.build.directory}<span class=nt>&lt;/workingDirectory&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;/configuration&gt;</span>
</span></span><span class=line><span class=cl>          <span class=nt>&lt;/execution&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;/executions&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;/plugin&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;plugin&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;groupId&gt;</span>org.apache.maven.plugins<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;artifactId&gt;</span>maven-compiler-plugin<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;version&gt;</span>3.8.1<span class=nt>&lt;/version&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;configuration&gt;</span>
</span></span><span class=line><span class=cl>          <span class=nt>&lt;source&gt;</span>${maven.compiler.source}<span class=nt>&lt;/source&gt;</span>
</span></span><span class=line><span class=cl>          <span class=nt>&lt;target&gt;</span>${maven.compiler.source}<span class=nt>&lt;/target&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;/configuration&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;/plugin&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;plugin&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;groupId&gt;</span>org.apache.maven.plugins<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;artifactId&gt;</span>maven-jar-plugin<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;version&gt;</span>3.2.2<span class=nt>&lt;/version&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;configuration&gt;</span>
</span></span><span class=line><span class=cl>          <span class=nt>&lt;archive&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;manifest&gt;</span>
</span></span><span class=line><span class=cl>              <span class=nt>&lt;addClasspath&gt;</span>true<span class=nt>&lt;/addClasspath&gt;</span>
</span></span><span class=line><span class=cl>              <span class=nt>&lt;mainClass&gt;</span>${mainClass}<span class=nt>&lt;/mainClass&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;/manifest&gt;</span>
</span></span><span class=line><span class=cl>          <span class=nt>&lt;/archive&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;/configuration&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;/plugin&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;plugin&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;groupId&gt;</span>org.apache.maven.plugins<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;artifactId&gt;</span>maven-assembly-plugin<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;executions&gt;</span>
</span></span><span class=line><span class=cl>          <span class=nt>&lt;execution&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;phase&gt;</span>package<span class=nt>&lt;/phase&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;goals&gt;</span>
</span></span><span class=line><span class=cl>              <span class=nt>&lt;goal&gt;</span>single<span class=nt>&lt;/goal&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;/goals&gt;</span>
</span></span><span class=line><span class=cl>          <span class=nt>&lt;/execution&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;/executions&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;configuration&gt;</span>
</span></span><span class=line><span class=cl>          <span class=nt>&lt;archive&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;manifest&gt;</span>
</span></span><span class=line><span class=cl>              <span class=nt>&lt;addClasspath&gt;</span>true<span class=nt>&lt;/addClasspath&gt;</span>
</span></span><span class=line><span class=cl>              <span class=nt>&lt;mainClass&gt;</span>${mainClass}<span class=nt>&lt;/mainClass&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;/manifest&gt;</span>
</span></span><span class=line><span class=cl>          <span class=nt>&lt;/archive&gt;</span>
</span></span><span class=line><span class=cl>          <span class=nt>&lt;descriptorRefs&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;descriptorRef&gt;</span>jar-with-dependencies<span class=nt>&lt;/descriptorRef&gt;</span>
</span></span><span class=line><span class=cl>          <span class=nt>&lt;/descriptorRefs&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;/configuration&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;/plugin&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/plugins&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;/build&gt;</span>
</span></span></code></pre></div><p>配置 profiles</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl>  <span class=nt>&lt;profiles&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;profile&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;id&gt;</span>native<span class=nt>&lt;/id&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;build&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;plugins&gt;</span>
</span></span><span class=line><span class=cl>          <span class=nt>&lt;plugin&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;groupId&gt;</span>org.graalvm.buildtools<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;artifactId&gt;</span>native-maven-plugin<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;version&gt;</span>${native.maven.plugin.version}<span class=nt>&lt;/version&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;extensions&gt;</span>true<span class=nt>&lt;/extensions&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;executions&gt;</span>
</span></span><span class=line><span class=cl>              <span class=nt>&lt;execution&gt;</span>
</span></span><span class=line><span class=cl>                <span class=nt>&lt;id&gt;</span>build-native<span class=nt>&lt;/id&gt;</span>
</span></span><span class=line><span class=cl>                <span class=nt>&lt;goals&gt;</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&lt;goal&gt;</span>build<span class=nt>&lt;/goal&gt;</span>
</span></span><span class=line><span class=cl>                <span class=nt>&lt;/goals&gt;</span>
</span></span><span class=line><span class=cl>                <span class=nt>&lt;phase&gt;</span>package<span class=nt>&lt;/phase&gt;</span>
</span></span><span class=line><span class=cl>              <span class=nt>&lt;/execution&gt;</span>
</span></span><span class=line><span class=cl>              <span class=nt>&lt;execution&gt;</span>
</span></span><span class=line><span class=cl>                <span class=nt>&lt;id&gt;</span>test-native<span class=nt>&lt;/id&gt;</span>
</span></span><span class=line><span class=cl>                <span class=nt>&lt;goals&gt;</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&lt;goal&gt;</span>test<span class=nt>&lt;/goal&gt;</span>
</span></span><span class=line><span class=cl>                <span class=nt>&lt;/goals&gt;</span>
</span></span><span class=line><span class=cl>                <span class=nt>&lt;phase&gt;</span>test<span class=nt>&lt;/phase&gt;</span>
</span></span><span class=line><span class=cl>              <span class=nt>&lt;/execution&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;/executions&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;configuration&gt;</span>
</span></span><span class=line><span class=cl>              <span class=nt>&lt;fallback&gt;</span>false<span class=nt>&lt;/fallback&gt;</span>
</span></span><span class=line><span class=cl>              <span class=nt>&lt;buildArgs&gt;</span>
</span></span><span class=line><span class=cl>                <span class=nt>&lt;arg&gt;</span>-H:DashboardDump=fortune -H:+DashboardAll<span class=nt>&lt;/arg&gt;</span>
</span></span><span class=line><span class=cl>              <span class=nt>&lt;/buildArgs&gt;</span>
</span></span><span class=line><span class=cl>              <span class=nt>&lt;agent&gt;</span>
</span></span><span class=line><span class=cl>                <span class=nt>&lt;enabled&gt;</span>true<span class=nt>&lt;/enabled&gt;</span>
</span></span><span class=line><span class=cl>                <span class=nt>&lt;options&gt;</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&lt;option&gt;</span>experimental-class-loader-support<span class=nt>&lt;/option&gt;</span>
</span></span><span class=line><span class=cl>                <span class=nt>&lt;/options&gt;</span>
</span></span><span class=line><span class=cl>              <span class=nt>&lt;/agent&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;/configuration&gt;</span>
</span></span><span class=line><span class=cl>          <span class=nt>&lt;/plugin&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;/plugins&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;/build&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/profile&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;/profiles&gt;</span>
</span></span></code></pre></div><p>3、使用 maven 编译，打包成本地可执行程序。</p><p>执行 Maven 命令</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>mvn clean package
</span></span></code></pre></div><p>或者</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>mvn  -Pnative -Dagent package 
</span></span></code></pre></div><p>编译打包的过程比较慢，因为要直接编译成机器码，所以比一般的编译过程要慢一些。看到下面的输入日志，说明打包成功了。</p><p><img src=https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/691d3aaf162b4890b0b6160c2a715e50~tplv-k3u1fbpfcp-zoom-1.image alt></p><p>4、运行可执行程序包，打开 target 目录，已经看到了<code>graalvm-demo-image</code>可执行程序包了，大小为 11.58M。</p><p><img src=https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/83ae594348264945ad56fc05b6130779~tplv-k3u1fbpfcp-zoom-1.image alt></p><p>然后就可以运行它了，进入到目录下，执行下面的命令运行，可以看到正常输出了。注意了，这时候已经是没有用到本地 JVM 了。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>./graalvm-demo-image 
</span></span><span class=line><span class=cl>Hello GraalVM!
</span></span></code></pre></div><p>这时候，用 <code>jps -l</code>命令已经看不到这个进程了，只能通过 <code>ps</code>看了。</p><h2 id=总结>总结</h2><p>虽然我们还没有看到有哪个公司说在用 GraalVM 了，但是 <code>Quarkus</code>、<code>Spring Boot</code>、<code>Spring</code>等很多的框架都已经支持 GraalVM 的 Native-image 模式，而且在 Orcale 的大力推广下，相信不久之后就会出现在更多的产品中。赶紧体验一下吧。</p></article><h4>相关文章</h4><dl class=row><dd class=col-md-9><a href=/category/java/JDK17/>新项目为什么决定用 JDK 17了</a></dd><dd class=col-md-9><a href=/category/java/JVM-%E5%86%85%E5%AD%98%E6%BA%A2%E5%87%BA%E7%9A%84%E5%8E%9F%E5%9B%A0%E5%8F%8A%E9%A2%84%E9%98%B2/>JVM 内存溢出的原因及预防</a></dd><dd class=col-md-9><a href=/category/java/%E5%A6%82%E4%BD%95%E7%BC%96%E8%AF%91%E8%87%AA%E5%B7%B1%E7%9A%84-JDK/>手把手教你编译属于自己的 JDK</a></dd><dd class=col-md-9><a href=/category/java/Java-%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%BC%AB%E6%B8%B8%E6%8C%87%E5%8D%97/>Java 字符串常量池漫游指南（图文并茂）</a></dd><dd class=col-md-9><a href=/category/java/%E7%BA%BF%E4%B8%8AJava%E7%A8%8B%E5%BA%8F%E5%8D%A0%E7%94%A8-CPU-%E8%BF%87%E9%AB%98%E8%AF%B7%E8%AF%B4%E4%B8%80%E4%B8%8B%E6%8E%92%E6%9F%A5%E6%96%B9%E6%B3%95/>线上Java程序占用 CPU 过高，请说一下排查方法？</a></dd></dl><div class=author-card><div class=underline></div><div class=author-box><div class=qr-author-image><a href=https://www.moonkite.cn><img src=/images/person.jpg alt=风筝></a></div><div class=author-content><p class=author-title>作者</p><p class=author-name>风筝</p><p class=author-desc>古时的风筝，一个平庸的程序员，主语言 Java，第二语言 Python，其实学 Python 的时间比 Java 还要早。喜欢写博客，写博客的过程能加深自己对一个知识点的理解，同时还可以分享给他人。喜欢做一些小东西，所以也会一些前端的东西，React、JavaScript、CSS 都会一些，做一些小工具还够用。</p></div></div></div><script src=https://utteranc.es/client.js repo=huzhicheng/blog-comment issue-term=pathname theme=github-light crossorigin=anonymous async></script></div></main><div class="footer gradient-2"><div class="container footer-container"><div class=row><div class="col-xs-4 col-sm-3 col-md-3 col-lg-3"><div class=footer-title>网站地图</div><ul class=list-unstyled><li><a href=https://moonkite.cn/tags/>标签</a></li><li><a href=https://moonkite.cn/categories/>分类</a></li><li><a rel=alternate type=application/rss+xml href=https://moonkite.cn/index.xml><i class="fas fa-rss-square"></i> RSS订阅</a></li></ul></div><div class="col-xs-4 col-sm-3 col-md-3 col-lg-3"><div class=footer-title>社群</div><ul class=list-unstyled><li><a href=https://github.com/huzhicheng rel=noopener target=_blank>GitHub</a></li></ul></div><div class="col-xs-4 col-sm-3 col-md-3 col-lg-3"><div class=footer-title>友链</div><ul class=list-unstyled><li><a href=https://github.com/huzhicheng rel=noopener target=_blank>关于我</a></li></ul></div><div class="col-xs-12 col-sm-3 col-md-3 col-lg-3"><p class="pull-right text-right"><small><em>Proudly powered by <a href=https://gohugo.io/ rel=noopener target=_blank>Hugo</a></em></small><br><small><em>Theme - <a href=https://github.com/shaform/hugo-theme-den rel=noopener target=_blank>Den</a></em></small><br><small>&copy;
风筝
2023</small></p></div></div><div class=busuanzi-footer><span id=busuanzi_container_site_pv>本站总访问量<span id=busuanzi_value_site_pv></span>次</span>
<span id=busuanzi_container_site_uv>本站访客数<span id=busuanzi_value_site_uv></span>人次</span></div></div></div><script src=https://code.jquery.com/jquery-3.3.1.slim.min.js integrity=sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo crossorigin=anonymous></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js integrity=sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49 crossorigin=anonymous></script>
<script src=/js/bootstrap_4.1.3_js_bootstrap.min.js integrity=sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy crossorigin=anonymous></script>
<script>$(document).ready(function(){$("#load_disqus").length&&$(window).scroll(function(){if($("#load_disqus").length){var e=$("#load_disqus").offset().top,t=$(window).scrollTop(),n=t+$(window).height();t<e&&e<n&&load_disqus()}})})</script></body></html>